{{define "budget_category_expenses_content"}}
<div class="budget-breadcrumb">
  <a href="/budget">Budget</a> → <a href="/budget/view?year={{.Budget.Year}}&month={{.Budget.Month}}">{{monthName .Budget.Month}} {{.Budget.Year}}</a> → {{.Category.Name}}
</div>
<div class="row">
  <div>
    <h1>{{.Category.Name}}</h1>
    <p>{{monthName .Budget.Month}} {{.Budget.Year}}</p>
  </div>
  <div class="budget-actions">
    <a href="/budget/view?year={{.Budget.Year}}&month={{.Budget.Month}}" class="btn ghost">← Budget</a>
    <a href="/budget/expense/add?category_id={{.Category.ID}}" class="btn primary">+ Record expense</a>
  </div>
</div>

<div class="spacer"></div>

<div class="card budget-summary-card">
  <div>
    <div class="label">Spent this month</div>
    <div class="value">{{money .TotalSpentCents}} <span style="font-weight: 500; color: var(--muted);">of {{money .Category.LimitCents}}</span></div>
    {{$pct := pct .TotalSpentCents .Category.LimitCents}}
    <div class="budget-progress">
      <div class="budget-progress-fill {{if gt $pct 100}}over{{end}}" style="width: {{if gt $pct 100}}100{{else}}{{$pct}}{{end}}%;"></div>
    </div>
  </div>
</div>

<div class="spacer"></div>

{{if .Expenses}}
<div class="card">
  <h2 style="margin-top: 0">Expense list</h2>
  <div class="table-wrapper">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Amount</th>
        <th>Note</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {{range .Expenses}}
      <tr>
        <td>{{.SpentOn.Format "2006-01-02"}}</td>
        <td><strong>{{money .AmountCents}}</strong></td>
        <td>{{if .Note}}{{.Note}}{{else}}<span style="color: var(--muted);">—</span>{{end}}</td>
        <td>
          <div class="budget-actions">
            <a href="/budget/expense/edit?id={{.ID}}" class="btn">Edit</a>
            <form method="POST" action="/budget/expense/delete" style="margin:0;" onsubmit="return confirm('Delete this expense?');">
              <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}" />
              <input type="hidden" name="id" value="{{.ID}}" />
              <button class="btn danger" type="submit">Delete</button>
            </form>
          </div>
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
  </div>
</div>
{{else}}
<div class="card empty-state">
  <h3>No expenses yet</h3>
  <p>Record spending for this category.</p>
  <a href="/budget/expense/add?category_id={{.Category.ID}}" class="btn primary">+ Record expense</a>
</div>
{{end}}
{{end}}
{{define "budget_category_expenses.html"}}{{template "layout" .}}{{end}}
