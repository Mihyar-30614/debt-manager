{{define "index_content"}}
<div class="breadcrumb"><span class="current">Dashboard</span></div>
<div class="row row-header">
  <div class="header-block">
    <h1>Dashboard</h1>
    <p>Balances, payments, and payoff planning in one place.</p>
    {{if gt .PaymentsThisMonthCount 0}}
    <p class="summary-line">You've made <strong>{{.PaymentsThisMonthCount}}</strong> {{if eq .PaymentsThisMonthCount 1}}payment{{else}}payments{{end}} this month ({{money .PaymentsThisMonthTotal}} total).</p>
    {{end}}
    <p class="total-balance-inline">
      <span class="total-balance-label">Total balance</span>
      <strong class="total-balance-value">{{money .Total}}</strong>
    </p>
  </div>
  <div class="page-actions">
    {{if .ActiveDebts}}
    <a href="/payments/new" class="btn primary">+ Record payment<span class="keyboard-hint">p</span></a>
    {{end}}
    <a href="/debts/new" class="btn primary">+ Add debt<span class="keyboard-hint">n</span></a>
  </div>
</div>

<div class="spacer"></div>

<div class="card">
  <h2 style="margin-top: 0">Filter debts</h2>
  <form method="GET" action="/" class="search-form" id="filter-form">
    <div class="search-field">
      <label>Search</label>
      <input
        id="search-input"
        name="search"
        type="text"
        placeholder="Search by name..."
        value="{{.SearchQuery}}"
        autocomplete="off"
      />
      <div class="help">Press <kbd>/</kbd> to focus</div>
    </div>
    <div class="search-field">
      <label>Type</label>
      <select name="kind">
        <option value="">All types</option>
        <option value="card" {{if eq .KindFilter "card"}}selected{{end}}>Credit Card</option>
        <option value="line_of_credit" {{if eq .KindFilter "line_of_credit"}}selected{{end}}>Line of Credit</option>
        <option value="personal_loan" {{if eq .KindFilter "personal_loan"}}selected{{end}}>Personal Loan</option>
        <option value="auto_loan" {{if eq .KindFilter "auto_loan"}}selected{{end}}>Auto Loan</option>
        <option value="student_loan" {{if eq .KindFilter "student_loan"}}selected{{end}}>Student Loan</option>
        <option value="mortgage" {{if eq .KindFilter "mortgage"}}selected{{end}}>Mortgage</option>
        <option value="other_loan" {{if eq .KindFilter "other_loan"}}selected{{end}}>Other Loan</option>
      </select>
    </div>
    <div class="search-field">
      <label>Status</label>
      <select name="status">
        <option value="">All</option>
        <option value="active" {{if eq .StatusFilter "active"}}selected{{end}}>Active</option>
        <option value="closed" {{if eq .StatusFilter "closed"}}selected{{end}}>Closed</option>
      </select>
    </div>
    <div class="search-actions">
      <div style="display: flex; flex-direction: column;">
        <label style="visibility: hidden; height: 0; margin: 0;">Actions</label>
        <div style="display: flex; gap: 8px;">
          {{if or .SearchQuery .KindFilter .StatusFilter}}
          <a href="/" class="btn ghost">Clear filters</a>
          {{end}}
        </div>
      </div>
    </div>
  </form>
</div>

<div class="spacer"></div>

<h2>Debts</h2>
{{if .Debts}}
{{$searchQuery := .SearchQuery}}
{{$kindFilter := .KindFilter}}
{{$statusFilter := .StatusFilter}}
{{$sortBy := .SortBy}}

<div class="debts-list">
  {{range .Debts}}
  <a href="/debts/view?id={{.ID}}" class="debt-card">
    <div class="debt-card-main">
      <span class="debt-card-name">{{.Name}}</span>
      <span class="debt-card-balance">{{money .BalanceCents}}</span>
    </div>
    <div class="debt-card-meta">
      <span class="badge">{{debtKind .Kind}}</span>
      {{if .Active}}
      <span class="badge good">Active</span>
      {{else}}
      <span class="badge">Closed</span>
      {{end}}
    </div>
  </a>
  {{end}}
</div>

<div class="table-wrapper debts-table">
<table>
  <thead>
    <tr>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "name_asc") "name_desc" "name_asc")}}" class="sort-link">
          Name
          {{if eq $sortBy "name_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "name_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "type_asc") "type_desc" "type_asc")}}" class="sort-link">
          Type
          {{if eq $sortBy "type_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "type_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "balance_desc") "balance_asc" "balance_desc")}}" class="sort-link">
          Balance
          {{if eq $sortBy "balance_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "balance_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "apr_desc") "apr_asc" "apr_desc")}}" class="sort-link">
          APR
          {{if eq $sortBy "apr_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "apr_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "min_desc") "min_asc" "min_desc")}}" class="sort-link">
          Min
          {{if eq $sortBy "min_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "min_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th class="sortable">
        <a href="{{buildSortURL $searchQuery $kindFilter $statusFilter (cond (eq $sortBy "due_desc") "due_asc" "due_desc")}}" class="sort-link">
          Due
          {{if eq $sortBy "due_asc"}}<span class="sort-indicator">↑</span>{{end}}
          {{if eq $sortBy "due_desc"}}<span class="sort-indicator">↓</span>{{end}}
        </a>
      </th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    {{range .Debts}}
    <tr>
      <td><a class="link" href="/debts/view?id={{.ID}}">{{.Name}}</a></td>
      <td><span class="badge">{{debtKind .Kind}}</span></td>
      <td>{{money .BalanceCents}}</td>
      <td>{{apr .APRBps}}</td>
      <td>{{money .MinPaymentCents}}</td>
      <td><span class="badge">Day {{.DueDay}}</span></td>
      <td>
        {{if .Active}}
        <span class="badge good">Active</span>
        {{else}}
        <span class="badge">Closed</span>
        {{end}}
      </td>
    </tr>
    {{end}}
  </tbody>
</table>
</div>
{{else}}
<div class="card empty-state">
  {{if or .SearchQuery .KindFilter .StatusFilter}}
  <h3>No debts match your filters</h3>
  <p>Try clearing the filters to see all debts, or add a new debt.</p>
  <a href="/" class="btn primary">Clear filters</a>
  {{else}}
  <h3>You're all set to add your first debt</h3>
  <p>Add a credit card, loan, or other debt to start tracking balances and payments. Your data stays on your device.</p>
  <a href="/debts/new" class="btn primary">+ Add your first debt</a>
  {{end}}
</div>
{{end}}
{{end}}
{{define "index.html"}}{{template "layout" .}}{{end}}
