{{define "debt_view_content"}}
<div class="row">
  <div>
    <h1>{{.Debt.Name}}</h1>
    <p>Manage this debt and record payments.</p>
  </div>
  <a href="/" class="btn">‚Üê Back</a>
</div>

<div class="grid cols-2">
  <div class="card">
    <div class="kpi">
      <div>
        <div class="badge">{{debtKind .Debt.Kind}}</div>
        {{if .Debt.Active}} <span class="badge good">Active</span> {{else}}
        <span class="badge">Closed</span> {{end}}
      </div>
      <div class="badge">Due day {{.Debt.DueDay}}</div>
    </div>

    <div class="spacer"></div>

    <div class="grid">
      <div class="row">
        <div class="badge">Balance</div>
        <div style="font-size: 26px; font-weight: 800">
          {{money .Debt.BalanceCents}}
        </div>
      </div>
      <div class="row">
        <div class="badge">APR</div>
        <div style="font-weight: 700">{{apr .Debt.APRBps}}</div>
      </div>
      <div class="row">
        <div class="badge">Minimum</div>
        <div style="font-weight: 700">{{money .Debt.MinPaymentCents}}</div>
      </div>
      {{if gt .Debt.PaymentCents 0}}
      <div class="row">
        <div class="badge">Payment</div>
        <div style="font-weight: 700">{{money .Debt.PaymentCents}}</div>
      </div>
      {{end}}
    </div>

    {{if .Debt.Notes}}
    <div class="spacer"></div>
    <div>
      <div class="badge" style="margin-bottom: 8px;">Notes</div>
      <div style="color: var(--muted); white-space: pre-wrap; line-height: 1.6;">{{.Debt.Notes}}</div>
    </div>
    {{end}}

    <div class="spacer"></div>

    <div class="row" style="gap: 8px;">
      <a href="/debts/edit?id={{.Debt.ID}}" class="btn">Edit</a>
      <form method="POST" action="/debts/toggle" style="margin:0;">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
        <input type="hidden" name="id" value="{{.Debt.ID}}" />
        {{if .Debt.Active}}
        <input type="hidden" name="active" value="0" />
        <button class="btn danger" type="submit">Close</button>
        {{else}}
        <input type="hidden" name="active" value="1" />
        <button class="btn primary" type="submit">Re-open</button>
        {{end}}
      </form>
      <form method="POST" action="/debts/delete" style="margin:0;" onsubmit="return confirm('Are you sure you want to delete this debt? This will also delete all associated payments.');">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
        <input type="hidden" name="id" value="{{.Debt.ID}}" />
        <button class="btn danger" type="submit">Delete</button>
      </form>
    </div>
  </div>

  <div class="card">
    <h2 style="margin-top: 0">Add payment</h2>
    <form method="POST" action="/payments/add" id="payment-form">
      <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
      <input type="hidden" name="debt_id" value="{{.Debt.ID}}" />

      <div class="formgrid cols-2">
        <div>
          <label>Date</label>
          <input name="paid_on" type="date" required />
        </div>
        <div>
          <label>Amount ($)</label>
          <input
            name="amount_dollars"
            type="number"
            step="0.01"
            min="0.01"
            required
          />
        </div>
      </div>

      <div class="spacer"></div>

      <div>
        <label>Note</label>
        <input name="note" placeholder="Optional" />
      </div>

      <div class="spacer"></div>

      <button class="btn primary" type="submit">Add payment</button>
    </form>
  </div>
</div>

<h2>Payments</h2>
{{if .Payments}}
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Amount</th>
      <th>Note</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {{range .Payments}}
    <tr>
      <td>{{.PaidOn.Format "2006-01-02"}}</td>
      <td>{{money .AmountCents}}</td>
      <td>{{.Note}}</td>
      <td>
        <div class="row" style="gap: 8px; justify-content: flex-start;">
          <a href="/payments/edit?id={{.ID}}" class="btn" style="padding: 6px 10px; font-size: 12px;">Edit</a>
          <form method="POST" action="/payments/delete" style="margin:0;" onsubmit="return confirm('Are you sure you want to delete this payment? The debt balance will be adjusted.');">
            <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}" />
            <input type="hidden" name="id" value="{{.ID}}" />
            <button class="btn danger" type="submit" style="padding: 6px 10px; font-size: 12px;">Delete</button>
          </form>
        </div>
      </td>
    </tr>
    {{end}}
  </tbody>
</table>
{{else}}
<div class="card empty-state" style="padding: 40px 20px;">
  <h3>No payments yet</h3>
  <p>Record your first payment above.</p>
</div>
{{end}}
{{end}}
{{define "debt_view.html"}}{{template "layout" .}}{{end}}
