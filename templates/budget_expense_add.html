{{define "budget_expense_add_content"}}
<div class="budget-breadcrumb">
  <a href="/budget">Budget</a> → <a href="/budget/view?year={{.Budget.Year}}&month={{.Budget.Month}}">{{monthName .Budget.Month}} {{.Budget.Year}}</a> → <a href="/budget/category/expenses?category_id={{.Category.ID}}">{{.Category.Name}}</a> → Record expense
</div>
<div class="row">
  <div>
    <h1>Record expense</h1>
    <p><span class="badge">{{.Category.Name}}</span> · {{monthName .Budget.Month}} {{.Budget.Year}}</p>
  </div>
  <a href="/budget/category/expenses?category_id={{.Category.ID}}" class="btn ghost">← Back to {{.Category.Name}}</a>
</div>

<div class="card">
  <form method="POST" action="/budget/expense/create">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}" />
    <input type="hidden" name="category_id" value="{{.Category.ID}}" />

    <div class="formgrid cols-2">
      <div>
        <label>Date</label>
        <input name="spent_on" type="date" id="expense-date" required />
      </div>
      <div>
        <label>Amount ($)</label>
        <div style="display: flex; gap: 8px; align-items: flex-start">
          <input
            name="amount_dollars"
            type="number"
            step="0.01"
            min="0.01"
            id="expense-amount"
            data-max-cents="{{.RemainingCents}}"
            required
            placeholder="0.00"
            style="flex: 1"
          />
          {{if gt .RemainingCents 0}}
          <button
            type="button"
            class="btn ghost"
            style="white-space: nowrap; padding: 0 12px"
            onclick="setMaxExpense()"
          >
            Max
          </button>
          {{end}}
        </div>
        {{if gt .RemainingCents 0}}
        <span class="muted" style="font-size: 0.9em">Remaining in {{.Category.Name}}: {{money .RemainingCents}}</span>
        {{end}}
      </div>
    </div>

    <div class="spacer"></div>

    <div>
      <label>Note (optional)</label>
      <input name="note" type="text" placeholder="e.g. Grocery run" />
    </div>

    <div class="spacer"></div>

    <button type="submit" class="btn primary">Record expense</button>
  </form>
</div>
<script>
  document.getElementById("expense-date").valueAsDate = new Date();

  function setMaxExpense() {
    const amountInput = document.getElementById("expense-amount");
    const remainingCents = parseInt(amountInput.dataset.maxCents || "0", 10);
    if (remainingCents > 0) {
      amountInput.value = (remainingCents / 100.0).toFixed(2);
    }
  }
</script>
{{end}}
{{define "budget_expense_add.html"}}{{template "layout" .}}{{end}}
